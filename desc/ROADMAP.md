# 拾光集 (TimeCollate) 开发路线图

## 1. 项目愿景

开发一个支持 Web 端编辑、云端存储与生成的“时光书”制作平台。

**核心价值**：极简编辑体验、所见即所得、数据云端安全存储、高质量后端导出（PDF/离线源码）。

**架构策略**：

- **初期**：前端 + 本地模拟接口 (Mock Service) -> 快速验证 MVP。
    
- **后期**：无缝接入后端 (Node/Go + MySQL + OSS) -> 处理重型任务（存储、高清生成）。
    
---

## 2. 阶段一：核心编辑器与架构地基 (The Editor & Architecture)

**目标**：搭建“未来可切换”的代码架构，完成基于本地存储的内容录入功能。

### 关键功能点

- [ ] **架构层建设 (核心)**：
    
    - 定义 `types.ts` (Book, Chapter, Photo)。
        
    - **编写 `IBookService` 接口**：定义 `save`, `load`, `upload` 标准。
        
    - 实现 `LocalBookService`：基于 `localStorage` 模拟异步数据交互，确保 UI 层不直接接触存储逻辑。
        
- [ ] **状态管理**：
    
    - 使用 **Zustand** 管理全书状态，通过 hook 调用 Service 层。
        
- [ ] **章节管理**：
    
    - 新建、删除章节。
        
    - **拖拽排序**：使用 `dnd-kit` 实现章节调序。
        
- [ ] **内容编辑表单**：
    
    - 文案输入与自动换行处理。
        
    - **图片上传器 (模拟)**：使用 `URL.createObjectURL` 生成预览，但在数据结构中预留 `oss_key` 字段。
        

### 🛠 技术难点与方案

- **接口隔离**：前端组件严禁出现 `localStorage.setItem`。必须调用 `bookService.save()`。这样未来接入 MySQL 时，组件代码一行都不用改。
    
- **完成标准**：用户可以流畅编辑书籍，刷新页面数据不丢失。
    
---

## 3. 阶段二：书籍渲染引擎 (The Renderer)

**目标**：实现“所见即所得”的排版系统，该系统未来将被复用于后端 PDF 生成。

### 关键功能点

- [ ] **预览容器**：
    
    - 开发 `BookPage` 组件，严格按照 A4/B5 物理尺寸比例（使用 `mm` 或 `pt` 单位）。
        
- [ ] **动态布局系统**：
    
    - **Grid 布局**：CSS Grid 实现的标准网格。
        
    - **Collage 布局**：拼贴风格。
        
    - **Full 布局**：沉浸式单图模式。
        
- [ ] **主题系统**：
    
    - 配置化主题（字体、色值、边框），通过 Context 注入全局。
        

### 🛠 技术难点与方案

- **打印一致性**：CSS 必须避免使用 `vh/vw` 等屏幕相关单位，改用固定比例，确保在后端无头浏览器中渲染结果与前端一致。
    
- **完成标准**：左侧编辑，右侧实时显示精美的书页预览。
    

---

## 4. 阶段三：云端化与持久化 (Cloud Integration)

**目标**：引入后端服务，替换本地存储，实现多端同步与海量存储。

### 关键功能点 🔴 (后端重心)

- [ ] **数据库设计**：
    
    - 部署 **MySQL**。设计表：`books`, `chapters`, `photos` (关联 `book_id`)。
        
- [ ] **服务端 API 开发**：
    
    - 实现 RESTful 接口：`/api/books`, `/api/upload`。
        
    - **OSS 对象存储接入**：配置阿里云/AWS S3，实现图片直传或服务端中转上传。
        
- [ ] **前端适配器切换** 🔵：
    
    - 编写 `CloudBookService` (基于 Axios)。
        
    - 在入口处将 `LocalBookService` 替换为 `CloudBookService`。
        
    - **无感升级**：UI 层逻辑保持不变。
        

### 🛠 技术难点与方案

- **图片大文件处理**：前端直接上传大图到 OSS（获取后端签名），后端只存 URL，减轻应用服务器带宽压力。
    
- **完成标准**：用户数据真正存入数据库，更换浏览器或设备后仍可访问。
    

---

## 5. 阶段四：服务端导出工厂 (The Server-Side Factory)

**目标**：将繁重的计算任务移交后端，生成高质量交付物。

### 关键功能点 🔴 (后端重心)

- [ ] **PDF 高清生成服务**：
    
    - **方案**：后端启动 **Playwright** (无头浏览器)。
        
    - **流程**：后端加载书页模板 -> 注入数据 -> 打印为 PDF -> 上传 OSS -> 返回下载链接。
        
    - _优势_：解决前端 `html2canvas` 模糊、跨页截断、浏览器崩溃问题。
        
- [ ] **离线源码打包服务**：
    
    - **方案**：Node.js Stream (流式处理)。
        
    - **流程**：读取 HTML 模板 + 下载 OSS 图片资源 + 注入 JSON -> 压缩为 ZIP -> 流式返回给用户。
        
    - _优势_：不占用用户内存，下载速度快。
        

### 🛠 技术难点与方案

- **任务队列**：PDF 生成极耗资源，需引入消息队列 (RabbitMQ) 进行异步处理，前端显示“生成中...”进度条。
    
- **完成标准**：点击导出，稍等片刻后获得一份矢量级高清 PDF 或包含所有资源的离线包。
    

---

## 6. 开发优先级与里程碑

1. **MVP (原型验证)** = 阶段一 (Mock数据) + 阶段二 (基础预览)。
    
    - _产出_：一个可以在本地玩、看效果的网页。
        
2. **Alpha (云端版)** = 阶段三 (接入 MySQL/OSS)。
    
    - _产出_：数据可以永久保存，支持多图上传。
        
3. **Release (正式版)** = 阶段四 (后端导出)。
    
    - _产出_：具备核心商业价值（PDF/实体书数据源）。
        
---